@* @page "/planets"

@using StarWars.Explorer.Components
@using StarWars.Explorer.Models
@using StarWars.Explorer.Services

@inject ISwapiService SwapiService

<div class="container mt-4">
	<h1>Star Wars Planets</h1>

	<SearchBox SearchText="@searchText" OnSearchChanged="HandleSearch" />

	@if (loading)
	{
		<LoadingIndicator />
	}
	else if (planets == null || !planets.Any())
	{
		<div class="alert alert-info">No planets found.</div>
	}
	else
	{
		<div class="row">
			@foreach (var planet in planets)
			{
				<div class="col-md-4 mb-4">
					<PlanetCard Planet="planet" />
				</div>
			}
		</div>
	}
</div>

@code {
	private List<Planet> planets;
	private bool loading = true;
	private string searchText = "";

	protected override async Task OnInitializedAsync()
	{
		await LoadPlanets();
	}

	private async Task LoadPlanets()
	{
		loading = true;
		planets = await SwapiService.GetPlanetsAsync(searchText);
		loading = false;
	}

	private async Task HandleSearch(string searchValue)
	{
		searchText = searchValue;
		await LoadPlanets();
	}
} *@

				@page "/planets"

@using StarWars.Explorer.Components
@using StarWars.Explorer.Models
@using StarWars.Explorer.Services

@inject ISwapiService SwapiService

<div class="container mt-4">
	<h1>Star Wars Planets</h1>

	<SearchBox SearchText="@searchText" OnSearchChanged="HandleSearch" />

	@if (loading)
	{
		<LoadingIndicator />
	}
	else if (planets == null || !planets.Any())
	{
		<div class="alert alert-info">No planets found.</div>
	}
	else
	{
		<div class="row">
			@foreach (var planet in planets)
			{
				<div class="col-md-4 mb-4">
					<PlanetCard Planet="planet" />
				</div>
			}
		</div>

		<!-- Pagination Controls -->
		<div class="d-flex justify-content-center mt-4">
			<button class="btn btn-secondary me-2" @onclick="PreviousPage" disabled="@(!CanGoPrevious)">Previous</button>
			<button class="btn btn-secondary" @onclick="NextPage" disabled="@(!CanGoNext)">Next</button>
		</div>
	}
</div>

@code {
	private List<Planet> planets = new();
	private bool loading = true;
	private string searchText = "";
	private int currentPage = 1;
	private int totalPages = 1;

	protected override async Task OnInitializedAsync()
	{
		await LoadPlanets();
	}

	private async Task LoadPlanets()
	{
		loading = true;
		var pagedResult = await SwapiService.GetPlanetsAsync(searchText, currentPage);
		planets = pagedResult.Items;
		totalPages = pagedResult.TotalPages;
		loading = false;
	}

	private async Task HandleSearch(string searchValue)
	{
		searchText = searchValue;
		currentPage = 1;
		await LoadPlanets();
	}

	private async Task NextPage()
	{
		if (currentPage < totalPages)
		{
			currentPage++;
			await LoadPlanets();
		}
	}

	private async Task PreviousPage()
	{
		if (currentPage > 1)
		{
			currentPage--;
			await LoadPlanets();
		}
	}

	private bool CanGoNext => currentPage < totalPages;
	private bool CanGoPrevious => currentPage > 1;
}
