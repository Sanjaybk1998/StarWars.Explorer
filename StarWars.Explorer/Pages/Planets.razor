@page "/planets"

@using StarWars.Explorer.Components
@using StarWars.Explorer.Models
@using StarWars.Explorer.Services

@inject ISwapiService SwapiService

<div class="container mt-4">
	<h1>Star Wars Planets</h1>

	<SearchBox SearchText="@searchText" OnSearchChanged="HandleSearch" />

	@if (loading)
	{
		<LoadingIndicator />
	}
	else if (planets == null || !planets.Any())
	{
		<div class="alert alert-info">No planets found.</div>
	}
	else
	{
		<div class="row">
			@foreach (var planet in planets)
			{
				<div class="col-md-4 mb-4">
					<PlanetCard Planet="planet" />
				</div>
			}
		</div>

		<PaginationControl Currentpage="@currentPage" Totalpages="@totalPages" OnPageChanged="HandlePageChange" />
	}
</div>

@code {
	private List<Planet> planets = new();
	private bool loading = true;
	private string searchText = "";
	private int currentPage = 1;
	private int totalPages = 1;

	protected override async Task OnInitializedAsync()
	{
		await LoadPlanets();
	}

	private async Task LoadPlanets()
	{
		loading = true;
		var pagedResult = await SwapiService.GetPlanetsAsync(searchText, currentPage);
		planets = pagedResult.Items;
		totalPages = pagedResult.TotalPages;
		loading = false;
	}

	private async Task HandleSearch(string searchValue)
	{
		searchText = searchValue;
		currentPage = 1;
		await LoadPlanets();
	}

	private async Task HandlePageChange(int newPage)
	{
		currentPage = newPage;
		await LoadPlanets();
	}
}
